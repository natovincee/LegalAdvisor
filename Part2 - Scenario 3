import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.openqa.selenium.support.ui.ExpectedConditions;

import java.time.Duration;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

public class SortingAndCartTest {

    public static void main(String[] args) {

        WebDriver driver = new ChromeDriver();
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));

        try {
            // 1. Login
            driver.get("https://www.saucedemo.com/");
            driver.manage().window().maximize();

            driver.findElement(By.id("user-name")).sendKeys("standard_user");
            driver.findElement(By.id("password")).sendKeys("secret_sauce");
            driver.findElement(By.id("login-button")).click();

            // 2. Sort by Price (high to low)
            Select sortDropdown = new Select(driver.findElement(By.className("product_sort_container")));
            sortDropdown.selectByValue("hilo");

            // 3. Verify sorting (high to low)
            List<WebElement> priceElements = driver.findElements(By.className("inventory_item_price"));
            List<Double> actualPrices = new ArrayList<>();

            for (WebElement price : priceElements) {
                actualPrices.add(Double.parseDouble(price.getText().replace("$", "")));
            }

            List<Double> sortedPrices = new ArrayList<>(actualPrices);
            sortedPrices.sort(Collections.reverseOrder());

            assert actualPrices.equals(sortedPrices)
                    : "Items are not sorted from high to low price";

            // 4. Add first item
            WebElement firstAddToCartBtn = driver.findElements(
                    By.xpath("//button[contains(@id,'add-to-cart')]")
            ).get(0);
            firstAddToCartBtn.click();

            // 5. Change sorting to Name (A to Z)
            sortDropdown.selectByValue("az");

            // 6. Verify cart still has 1 item
            WebElement cartBadge = driver.findElement(By.className("shopping_cart_badge"));
            assert cartBadge.getText().equals("1") : "Cart count changed after sorting";

            // 7. Go to cart and remove item
            driver.findElement(By.className("shopping_cart_link")).click();
            driver.findElement(By.xpath("//button[contains(@id,'remove')]")).click();

            // 8. Verify cart is empty
            List<WebElement> emptyCartBadge = driver.findElements(By.className("shopping_cart_badge"));
            assert emptyCartBadge.isEmpty() : "Cart is not empty after removal";

            System.out.println("SORTING & CART TEST PASSED");

        } finally {
            driver.quit();
        }
    }
}
